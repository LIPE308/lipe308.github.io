<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotasol - Transportadora Solidária</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="shortcut icon" href="rotalsol_logo-removebg-preview.ico" type="image/x-icon">
  <style>
    .user-menu {
        position: relative;
        display: inline-block;
    }
    .user-dropdown {
        position: absolute;
        top: 50px;
        right: 0;
        background: var(--light);
        border: 1px solid var(--gray-light);
        border-radius: var(--radius);
        padding: 15px;
        box-shadow: var(--shadow);
        z-index: 1000;
        min-width: 250px;
        display: none;
    }
    .user-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        margin-right: 8px;
        object-fit: cover;
        margin-top: 15px;
    }
    .user-avatar-large {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin-right: 10px;
        object-fit: cover;
    }
    .user-header {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    .user-dropdown hr {
        margin: 10px 0;
        border: none;
        border-top: 1px solid var(--gray-light);
    }
    .user-dropdown p {
        margin: 5px 0;
        font-size: 0.9rem;
        color: var(--text);
    }
    :root {
        --primary: #4a6cf7;
        --primary-dark: #3a5bd9;
        --secondary: #ffce3e;
        --accent: #6e8efb;
        --success: #48bb78;
        --warning: #ecc94b;
        --danger: #f56565;
        --dark: #1a202c;
        --light: #f7fafc;
        --gray: #718096;
        --gray-light: #e2e8f0;
        --text: #2d3748;
        --text-light: #f8f9fa;
        --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --radius: 12px;
        --transition: all 0.3s ease;
    }
    .dark-mode {
        --primary: #5c7cfa;
        --primary-dark: #4a6cf7;
        --secondary: #ffd700;
        --accent: #7e9afb;
        --success: #68d391;
        --warning: #f6e05e;
        --danger: #fc8181;
        --dark: #f7fafc;
        --light: #1a202c;
        --gray: #a0aec0;
        --gray-light: #2d3748;
        --text: #f8f9fa;
        --text-light: #2d3748;
    }
    *  {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    html {
        scroll-behavior: smooth;
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--light);
        color: var(--text);
        line-height: 1.6;
        transition: var(--transition);
        overflow-x: hidden;
    }
    .container {
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
    }
    header {
        background-color: var(--light);
        box-shadow: var(--shadow);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
        transition: var(--transition);
    }

    .header-scrolled {
        padding: 10px 0;
        background-color: rgba(255, 255, 255, 0.95);
    }

    .dark-mode .header-scrolled {
        background-color: rgba(26, 32, 44, 0.95);
    }

    .navbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary);
    }

    .logo-icon {
        font-size: 2rem;
    }

    .nav-links {
        display: flex;
        list-style: none;
        gap: 40px;
    }

    .nav-links a {
        text-decoration: none;
        color: var(--text);
        font-weight: 500;
        transition: var(--transition);
        position: relative;
        padding: 8px 0;
    }

    .nav-links a:hover {
        color: var(--primary);
    }

    .nav-links a::after {
        content: '';
        position: absolute;
        width: 0;
        height: 2px;
        bottom: -5px;
        left: 0;
        background-color: var(--primary);
        transition: var(--transition);
    }

    .nav-links a:hover::after {
        width: 100%;
    }

    .nav-actions {
        display: flex;
        align-items: center;
        gap: 25px;
    }

    .theme-toggle {
        width: 50px;
        height: 26px;
        background: var(--gray-light);
        border-radius: 50px;
        padding: 3px;
        cursor: pointer;
        position: relative;
        transition: var(--transition);
    }

    .toggle-handle {
        width: 20px;
        height: 20px;
        background: var(--secondary);
        border-radius: 50%;
        transition: var(--transition);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
    }

    .dark-mode .toggle-handle {
        transform: translateX(24px);
        background: var(--light);
    }

    .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        font-size: 1.5rem;
        color: var(--text);
        cursor: pointer;
    }

    .hero {
        padding: 160px 0 100px;
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        color: white;
        text-align: center;
        position: relative;
        overflow: hidden;
    }

    .hero::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.1" d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,192C672,181,768,139,864,138.7C960,139,1056,181,1152,197.3C1248,213,1344,203,1392,197.3L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>');
        background-size: cover;
        background-position: bottom;
    }

    .hero-content {
        position: relative;
        z-index: 1;
        max-width: 800px;
        margin: 0 auto;
    }

    .hero h1 {
        font-size: 3.5rem;
        margin-bottom: 20px;
        font-weight: 700;
    }

    .hero p {
        font-size: 1.2rem;
        margin-bottom: 30px;
        opacity: 0.9;
    }

    .hero-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
    }

    .btn {
        padding: 12px 30px;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        transition: var(--transition);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        cursor: pointer;
        font-size: 1rem;
    }
    
    .btn-primary {
        background-color: var(--secondary);
        color: var(--dark);
    }

    .btn-primary:hover {
        background-color: #e2e8f0;
        transform: translateY(-3px);
    }

    .btn-secondary {
        background-color: transparent;
        color: var(--text);
        border: 2px solid var(--text);
    }

    .btn-secondary:hover {
        background-color: var(--text);
        color: var(--primary);
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    section {
        padding: 100px 0;
    }

    .section-title {
        text-align: center;
        margin-bottom: 60px;
    }

    .section-title h2 {
        font-size: 2.5rem;
        margin-bottom: 15px;
        color: var(--text);
    }

    .section-title p {
        font-size: 1.1rem;
        color: var(--gray);
        max-width: 600px;
        margin: 0 auto;
    }

    .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 30px;
    }

    .card {
        background: var(--light);
        border-radius: var(--radius);
        padding: 30px;
        box-shadow: var(--shadow);
        transition: var(--transition);
        border-top: 4px solid var(--primary);
    }

    .card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .card-icon {
        font-size: 2.5rem;
        color: var(--primary);
        margin-bottom: 20px;
    }

    .card h3 {
        font-size: 1.5rem;
        margin-bottom: 15px;
        color: var(--text);
    }

    .card p {
        color: var(--gray);
    }
.card:nth-child(3n+1) {
    border-top: 4px solid var(--success);
}

.card:nth-child(3n+1) .card-icon {
    color: var(--success);
}

.card:nth-child(3n+1) .btn-primary {
    background-color: var(--success);
    border-color: var(--success);
}

.card:nth-child(3n+2) {
    border-top: 4px solid var(--danger);
}

.card:nth-child(3n+2) .card-icon {
    color: var(--danger);
}

.card:nth-child(3n+2) .btn-primary {
    background-color: var(--danger);
    border-color: var(--danger);
}

.card:nth-child(3n+3) {
    border-top: 4px solid var(--warning);
}

.card:nth-child(3n+3) .card-icon {
    color: var(--warning);
}

.card:nth-child(3n+3) .btn-primary {
    background-color: var(--warning);
    border-color: var(--warning);
    color: var(--dark);
}

    .mapa-section {
        background-color: var(--gray-light);
    }

    .dark-mode .mapa-section {
        background-color: #2d3748;
    }

    .mapa-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        align-items: center;
    }

    .mapa-info {
        padding: 20px;
    }

    .mapa-info h3 {
        font-size: 1.8rem;
        margin-bottom: 20px;
        color: var(--primary);
    }

    .mapa-info p {
        margin-bottom: 30px;
        color: var(--text);
    }

    .localizador {
        background: var(--light);
        padding: 20px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 20px;
    }

    .localizador h4 {
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--text);
    }

    .localizador-input {
        display: flex;
        gap: 10px;
    }

    .localizador-input input {
        flex: 1;
        padding: 12px 15px;
        border: 1px solid var(--gray-light);
        border-radius: var(--radius);
        background: var(--light);
        color: var(--text);
    }

    .lista-pontos {
        max-height: 300px;
        overflow-y: auto;
    }

    .ponto-item {
        background: var(--light);
        padding: 15px;
        margin-bottom: 10px;
        border-radius: var(--radius);
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        display: flex;
        align-items: center;
        gap: 15px;
        cursor: pointer;
        transition: var(--transition);
    }

    .ponto-item:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .ponto-item i {
        color: var(--primary);
        font-size: 1.2rem;
    }

    .ponto-info h5 {
        margin-bottom: 5px;
        color: var(--text);
    }

    .ponto-info p {
        font-size: 0.9rem;
        color: var(--gray);
    }

    .mapa {
        height: 500px;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: var(--shadow);
    }

    #map {
        height: 100%;
        width: 100%;
    }

    .features {
        background-color: var(--gray-light);
    }

    .dark-mode .features {
        background-color: #2d3748;
    }

    .feature-tabs {
        display: flex;
        justify-content: center;
        margin-bottom: 40px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .tab-btn {
        padding: 10px 20px;
        background: transparent;
        border: none;
        border-radius: 50px;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        color: var(--text);
    }

    .tab-btn.active {
        background: var(--primary);
        color: white;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
        animation: fadeIn 0.5s ease;
    }

    .feature-content {
        display: flex;
        align-items: center;
        gap: 50px;
    }

    .feature-image {
        flex: 1;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: var(--shadow);
    }

    .feature-image img {
        width: 100%;
        height: auto;
        display: block;
    }

    .feature-text {
        flex: 1;
    }

    .feature-text h3 {
        font-size: 2rem;
        margin-bottom: 20px;
        color: var(--text);
    }

    .feature-text ul {
        list-style: none;
        margin-top: 20px;
    }

    .feature-text li {
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--text);
    }

    .feature-text li i {
        color: var(--success);
    }

    #estoque {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        padding: 80px 0;
        min-height: 100vh;
    }

    .dark-mode #estoque {
        background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
    }

    .dashboard-container {
        max-width: 1200px;
        margin: 0 auto;
    }

    /* Grid de Estatísticas */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: var(--light);
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        display: flex;
        align-items: center;
        gap: 20px;
        transition: all 0.3s ease;
        border-left: 4px solid;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    }

    .stat-card.primary {
        border-left-color: var(--primary);
    }

    .stat-card.success {
        border-left-color: var(--success);
    }

    .stat-card.warning {
        border-left-color: var(--warning);
    }

    .stat-card.info {
        border-left-color: var(--accent);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
    }

    .stat-card.primary .stat-icon { background: var(--primary); }
    .stat-card.success .stat-icon { background: var(--success); }
    .stat-card.warning .stat-icon { background: var(--warning); }
    .stat-card.info .stat-icon { background: var(--accent); }

    .stat-content h3 {
        font-size: 2rem;
        font-weight: 700;
        margin: 0 0 5px 0;
        color: var(--text);
    }

    .stat-content p {
        margin: 0;
        color: var(--gray);
        font-size: 0.9rem;
    }

    .stat-trend {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.8rem;
        margin-top: 5px;
        color: var(--gray);
    }

    /* Layout Principal */
    .dashboard-main {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }

    /* Container do Gráfico */
    .chart-container {
        background: var(--light);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .chart-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .chart-header h3 {
        margin: 0;
        color: var(--text);
        font-size: 1.3rem;
    }

    .chart-controls {
        display: flex;
        gap: 10px;
    }

    .chart-btn {
        background: var(--gray-light);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        color: var(--gray);
    }

    .chart-btn.active,
    .chart-btn:hover {
        background: var(--primary);
        color: white;
    }

    .chart-wrapper {
        height: 250px;
        position: relative;
    }

    .table-container {
        background: var(--light);
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        display: flex;
        flex-direction: column;
    }

    .table-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .table-header h3 {
        margin: 0;
        color: var(--text);
        font-size: 1.3rem;
    }

    .table-actions {
        display: flex;
        gap: 10px;
    }

    .action-btn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 8px;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .action-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
    }

    .table-responsive {
        overflow-x: auto;
        flex: 1;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
        background: var(--light);
        color: var(--text);
    }

    th {
        background: var(--primary);
        color: white;
        padding: 15px 12px;
        font-weight: 600;
        text-align: left;
        white-space: nowrap;
        border: none;
    }

    th i {
        margin-right: 8px;
        opacity: 0.9;
    }

    td {
        padding: 12px;
        border-bottom: 1px solid var(--gray-light);
        vertical-align: middle;
        color: var(--text);
        background: var(--light);
    }

    tbody tr {
        transition: all 0.3s ease;
    }

    tbody tr:hover {
        background: rgba(74, 108, 247, 0.05);
    }

    .status-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 8px;
    }

    .status-dot.excellent { background: var(--success); }
    .status-dot.good { background: #10b981; }
    .status-dot.low { background: var(--warning); }
    .status-dot.critical { background: var(--danger); }

    .status-cell {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .progress-cell {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .progress-bar {
        flex: 1;
        height: 6px;
        background: var(--gray-light);
        border-radius: 3px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s ease;
    }

    .progress-fill.excellent { background: var(--success); }
    .progress-fill.good { background: #10b981; }
    .progress-fill.low { background: var(--warning); }
    .progress-fill.critical { background: var(--danger); }

    .loading-text {
        text-align: center;
        color: var(--gray);
        padding: 40px !important;
    }

    .dashboard-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--light);
        padding: 20px 25px;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }

    .legend h4 {
        margin: 0 0 10px 0;
        font-size: 1rem;
        color: var(--text);
    }

    .legend-items {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.85rem;
        color: var(--gray);
    }

    .last-update p {
        margin: 0;
        font-size: 0.85rem;
        color: var(--gray);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .faq-container {
        max-width: 800px;
        margin: 0 auto;
    }

    .faq-item {
        margin-bottom: 15px;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .faq-question {
        padding: 20px;
        background: var(--light);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-weight: 600;
        transition: var(--transition);
        color: var(--text);
    }

    .faq-question:hover {
        background: var(--gray-light);
    }

    .faq-answer {
        padding: 0 20px;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease, padding 0.3s ease;
        background: var(--gray-light);
        color: var(--text);
    }

    .faq-item.active .faq-answer {
        padding: 20px;
        max-height: 500px;
    }

    .faq-item.active .faq-question i {
        transform: rotate(180deg);
    }

    .contact-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 50px;
    }

    .contact-info {
        display: flex;
        flex-direction: column;
        gap: 30px;
    }

    .contact-item {
        display: flex;
        align-items: flex-start;
        gap: 15px;
    }

    .contact-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: var(--primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .contact-text h3 {
        margin-bottom: 5px;
        color: var(--text);
    }

    .contact-text p {
        color: var(--gray);
    }

    .contact-form {
        background: var(--light);
        padding: 30px;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text);
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--gray-light);
        border-radius: var(--radius);
        background: var(--light);
        color: var(--text);
        transition: var(--transition);
    }

    .form-control:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
    }

    textarea.form-control {
        min-height: 150px;
        resize: vertical;
    }

    footer {
        background: var(--dark);
        color: var(--text-light);
        padding: 80px 0 0;
    }

    .footer-content {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 40px;
        margin-bottom: 60px;
    }

    .footer-column h3 {
        font-size: 1.3rem;
        margin-bottom: 20px;
        position: relative;
        padding-bottom: 10px;
        color: var(--text-light);
    }

    .footer-column h3::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 40px;
        height: 2px;
        background: var(--primary);
    }

    .footer-links {
        list-style: none;
    }

    .footer-links li {
        margin-bottom: 10px;
    }

    .footer-links a {
        color: var(--gray);
        text-decoration: none;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .footer-links a:hover {
        color: var(--primary);
        padding-left: 5px;
    }

    .footer-bottom {
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding: 20px 0;
        text-align: center;
        color: var(--gray);
    }

    .social-links {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        justify-content: center;
    }

    .social-links a {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: var(--transition);
    }

    .social-links a:hover {
        background: var(--primary);
        transform: translateY(-3px);
    }

    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        animation: slideInRight 0.3s ease;
    }

    .notification.success {
        background: var(--success);
    }

    .notification.error {
        background: var(--danger);
    }

    .notification.info {
        background: var(--primary);
    }

    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes slideOutRight {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .fade-in {
        animation: fadeIn 0.8s ease;
    }

    .fade-in-up {
        animation: fadeInUp 0.5s ease;
    }

    @media (max-width: 992px) {
        .hero h1 {
            font-size: 2.8rem;
        }
        
        .mapa-container {
            grid-template-columns: 1fr;
        }
        
        .feature-content {
            flex-direction: column;
        }
        
        .contact-container {
            grid-template-columns: 1fr;
        }
        
        .dashboard-main {
            grid-template-columns: 1fr;
        }
    }

    @media (max-width: 768px) {
        .nav-links {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            width: 100%;
            background: var(--light);
            flex-direction: column;
            padding: 20px;
            box-shadow: var(--shadow);
            z-index: 1000;
            gap: 15px;
        }
        
        .nav-links.active {
            display: flex;
        }
        
        .mobile-menu-btn {
            display: block;
        }
        
        .hero h1 {
            font-size: 2.2rem;
        }
        
        .hero-buttons {
            flex-direction: column;
            align-items: center;
        }
        
        .btn {
            width: 100%;
            max-width: 250px;
            justify-content: center;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .dashboard-footer {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .table-header {
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }
        
        .table-actions {
            width: 100%;
            justify-content: flex-end;
        }
    }

    @media (max-width: 576px) {
        section {
            padding: 60px 0;
        }
        
        .section-title h2 {
            font-size: 2rem;
        }
        
        .card, .pricing-card {
            padding: 20px;
        }
        
        .mapa {
            height: 350px;
        }
        
        .nav-actions {
            gap: 15px;
        }
    }

    .user-avatar:hover, .user-avatar-large:hover {
        opacity: 0.9;
        transform: scale(1.05);
        transition: all 0.3s ease;
    }

    .user-avatar, .user-avatar-large {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    .photo-upload-area {
        border: 2px dashed var(--gray-light);
        border-radius: var(--radius);
        padding: 30px;
        text-align: center;
        cursor: pointer;
        transition: var(--transition);
        margin-bottom: 20px;
    }

    .photo-upload-area:hover {
        border-color: var(--primary);
        background: rgba(74, 108, 247, 0.05);
    }

    .photo-upload-area.dragover {
        border-color: var(--primary);
        background: rgba(74, 108, 247, 0.1);
    }

    .photo-preview {
        max-width: 200px;
        max-height: 200px;
        border-radius: var(--radius);
        margin: 0 auto 20px;
        display: block;
    }

    .upload-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 15px;
    }

    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }

    .loading-pulse {
        animation: pulse 1.5s ease-in-out infinite;
    }
.blog-meta {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    font-size: 0.9rem;
    color: var(--gray);
}

.blog-meta span {
    display: flex;
    align-items: center;
    gap: 5px;
}

.blog-card {
    background: var(--light);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    transition: var(--transition);
}

.blog-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
}

.blog-image {
    height: 200px;
    overflow: hidden;
}

.blog-content {
    padding: 25px;
}

.blog-content h3 {
    font-size: 1.3rem;
    margin-bottom: 15px;
    color: var(--text);
}

.blog-content p {
    color: var(--gray);
    margin-bottom: 20px;
}

.route-info {
    background: var(--light);
    padding: 20px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    margin-top: 20px;
    display: none;
}

.route-info.active {
    display: block;
    animation: fadeIn 0.5s ease;
}

.route-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
}

.route-detail {
    text-align: center;
    padding: 15px;
    background: var(--gray-light);
    border-radius: var(--radius);
}

.route-detail i {
    font-size: 1.5rem;
    color: var(--primary);
    margin-bottom: 8px;
    display: block;
}

.route-detail .value {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text);
    margin: 5px 0;
}

.route-detail .label {
    font-size: 0.8rem;
    color: var(--gray);
}

.route-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
}

.autocomplete-container {
    position: relative;
    width: 100%;
    margin-bottom: 10px;
}

.autocomplete-results {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--light);
    border: 1px solid var(--gray-light);
    border-radius: 0 0 var(--radius) var(--radius);
    max-height: 300px;
    overflow-y: auto;
    z-index: 1000;
    display: none;
    box-shadow: var(--shadow);
    border-top: none;
    margin-top: -1px;
}

.autocomplete-results.active {
    display: block;
    animation: fadeIn 0.2s ease;
}

.autocomplete-item {
    padding: 12px 15px;
    cursor: pointer;
    border-bottom: 1px solid var(--gray-light);
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--light);
}

.autocomplete-item:last-child {
    border-bottom: none;
}

.autocomplete-item:hover {
    background: var(--primary);
    color: white;
}

.autocomplete-item:hover .autocomplete-address {
    color: rgba(255,255,255,0.8);
}

.autocomplete-item i {
    color: var(--primary);
    font-size: 1rem;
    width: 16px;
    text-align: center;
}

.autocomplete-item:hover i {
    color: white;
}

.autocomplete-text {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.autocomplete-title {
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 2px;
}

.autocomplete-address {
    font-size: 0.85rem;
    color: var(--gray);
    line-height: 1.3;
}

.localizador-input {
    display: flex;
    gap: 0;
    border-radius: var(--radius);
    overflow: hidden;
    border: 2px solid var(--gray-light);
    transition: var(--transition);
}

.localizador-input:focus-within {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.1);
}

.localizador-input input {
    flex: 1;
    padding: 12px 15px;
    border: none;
    background: var(--light);
    color: var(--text);
    font-size: 1rem;
    outline: none;
}

.localizador-input input::placeholder {
    color: var(--gray);
}

.localizador-input button {
    padding: 12px 20px;
    border: none;
    background: var(--primary);
    color: white;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 50px;
}

.localizador-input button:hover {
    background: var(--primary-dark);
}

.autocomplete-container:has(.autocomplete-results.active) .localizador-input {
    border-radius: var(--radius) var(--radius) 0 0;
    border-bottom: none;
}

.route-line {
    stroke: var(--primary);
    stroke-width: 5;
    stroke-dasharray: 10, 10;
    opacity: 0.7;
    animation: dash 1.5s linear infinite;
}

@keyframes dash {
    to {
        stroke-dashoffset: -20;
    }
}

.route-marker {
    background: var(--primary);
    border-radius: 50%;
    width: 12px;
    height: 12px;
    border: 3px solid white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

.route-loading {
    text-align: center;
    padding: 20px;
    color: var(--gray);
}

.route-loading i {
    font-size: 1.5rem;
    margin-bottom: 10px;
    display: block;
}

.start-marker {
    background: #48bb78 !important; 
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.dest-marker {
    background: #e53e3e !important;
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.route-marker {
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
}
</style>
</head>
<body>
    <header id="header">
        <div class="container">
            <nav class="navbar">
                <a class="logo">
                    <i class="fas fa-route logo-icon"></i>
                    <span>Rotasol</span>
                </a>
                
                <ul class="nav-links">
                    <li><a href="#home">Início</a></li>
                    <li><a href="#sobre">Sobre</a></li>
                    <li><a href="#mapa">Pontos de Coleta</a></li>
                    <li><a href="#funcionalidades">Funcionalidades</a></li>
                    <li><a href="#blog">Blog</a></li>
                    <li><a href="#contato">Contato</a></li>
                </ul>
                
                <div class="nav-actions">
                   <a href="teladelogin.html" class="btn btn-primary" id="loginBtn">Entrar</a>

                    <div class="theme-toggle" id="themeToggle">
                        <div class="toggle-handle"><i class="fas fa-sun"></i></div>
                    </div>
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <h1>Rotasol - Transportadora Solidária</h1>
                <p>Conectando doadores e quem precisa através de uma rede de transporte solidário. Junte-se a nós e faça a diferença!</p>
                <div class="hero-buttons">
                    <a href="#mapa" class="btn btn-primary"><i class="fas fa-map-marker-alt"></i> Encontrar Pontos de Coleta</a>
                    <a href="#sobre" class="btn btn-secondary"><i class="fas fa-hands-helping"></i> Como Ajudar</a>
                </div>
            </div>
        </div>
    </section>

    <section id="sobre">
        <div class="container">
            <div class="section-title">
                <h2>Sobre a Rotasol</h2>
                <p>Uma iniciativa solidária que conecta doadores a comunidades necessitadas através de uma rede de transporte eficiente</p>
            </div>
            
            <div class="cards">
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-truck-loading"></i>
                    </div>
                    <h3>Coleta Eficiente</h3>
                    <p>Coletamos doações em pontos estratégicos e as distribuímos para comunidades carentes de forma organizada e eficiente.</p>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-hand-holding-heart"></i>
                    </div>
                    <h3>Solidariedade</h3>
                    <p>Nossa missão é conectar quem pode ajudar com quem precisa de ajuda, criando uma rede de solidariedade.</p>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <h3>Amplo Alcance</h3>
                    <p>Atuamos em diversas regiões, garantindo que as doações cheguem a locais de difícil acesso.</p>
                </div>
            </div>
        </div>
    </section>

<section class="mapa-section" id="mapa">
    <div class="container">
        <div class="section-title">
            <h2>Pontos de Coleta</h2>
            <p>Encontre o ponto de coleta mais próximo de você</p>
        </div>
        
        <div class="mapa-container">
            <div class="mapa-info">
                <h3>Encontre um ponto de coleta</h3>
                <p>Utilize nossa ferramenta para encontrar o ponto de coleta mais próximo da sua localização. Você também pode pesquisar por endereço específico.</p>
                
                        <div class="localizador">
                <h4><i class="fas fa-search-location"></i> Localizador</h4>
                <div class="autocomplete-container">
                    <div class="localizador-input">
                        <input type="text" id="enderecoInput" placeholder="Digite sua cidade, endereço ou ponto de referência...">
                        <button class="btn btn-primary" id="buscarEndereco">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div class="autocomplete-results" id="autocompleteResults"></div>
                </div>
                <button class="btn btn-secondary" id="usarLocalizacao" style="width:100%;margin-top:10px;">
                    <i class="fas fa-location-arrow"></i> Usar minha localização
                </button>
            </div>

                <div class="route-info" id="routeInfo">
                    <h4><i class="fas fa-route"></i> Rota para o Ponto Mais Próximo</h4>
                    <div class="route-details">
                        <div class="route-detail">
                            <i class="fas fa-road"></i>
                            <div class="value" id="routeDistance">-</div>
                            <div class="label">Distância</div>
                        </div>
                        <div class="route-detail">
                            <i class="fas fa-clock"></i>
                            <div class="value" id="routeTime">-</div>
                            <div class="label">Tempo</div>
                        </div>
                        <div class="route-detail">
                            <i class="fas fa-walking"></i>
                            <div class="value" id="routeType">-</div>
                            <div class="label">Modalidade</div>
                        </div>
                    </div>
                    <div class="route-actions">
                        <button class="btn btn-primary" id="startNavigation">
                            <i class="fas fa-play"></i> Iniciar Navegação
                        </button>
                        <button class="btn btn-secondary" id="clearRoute">
                            <i class="fas fa-times"></i> Limpar Rota
                        </button>
                    </div>
                </div>
                
                <div class="lista-pontos" id="listaPontos">

                </div>
            </div>
            
            <div class="mapa">
                <div id="map"></div>
            </div>
        </div>
    </div>
</section>

    <section class="features" id="funcionalidades">
        <div class="container">
            <div class="section-title">
                <h2>Como Funciona</h2>
                <p>Conheça nosso processo de coleta e distribuição de doações</p>
            </div>
            
            <div class="feature-tabs">
                <button class="tab-btn active" data-tab="tab1">Para Doadores</button>
                <button class="tab-btn" data-tab="tab2">Para Comunidades</button>
            </div>
            
            <div class="tab-content active" id="tab1">
                <div class="feature-content">
                    <div class="feature-image">
                        <div style="width:100%;height:300px;background:linear-gradient(135deg, #6e8efb 0%, #a777e3 100%);display:flex;align-items:center;justify-content:center;color:white;font-size:1.5rem;text-align:center;padding:20px;">
                            Doe com Facilidade
                        </div>
                    </div>
                    <div class="feature-text">
                        <h3>Como Doar</h3>
                        <p>Fazer uma doação através da Rotasol é simples e seguro. Siga estes passos:</p>
                        <ul>
                            <li><i class="fas fa-check"></i> Encontre o ponto de coleta mais próximo</li>
                            <li><i class="fas fa-check"></i> Separe itens em bom estado (alimentos não perecíveis, roupas, produtos de higiene)</li>
                            <li><i class="fas fa-check"></i> Leve sua doação ao ponto de coleta</li>
                            <li><i class="fas fa-check"></i> Receba um comprovante de doação</li>
                            <li><i class="fas fa-check"></i> Acompanhe o destino da sua doação</li>
                        </ul>
                        <a href="#mapa" class="btn btn-primary" style="margin-top:20px;">Encontrar Ponto de Coleta</a>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="tab2">
                <div class="feature-content">
                    <div class="feature-text">
                        <h3>Para Comunidades</h3>
                        <p>Se sua comunidade precisa de ajuda, veja como podemos trabalhar juntos:</p>
                        <ul>
                            <li><i class="fas fa-check"></i> Cadastre sua comunidade no sistema</li>
                            <li><i class="fas fa-check"></i> Informe suas necessidades específicas</li>
                            <li><i class="fas fa-check"></i> Receba doações de forma organizada</li>
                            <li><i class="fas fa-check"></i> Participe de nossos programas de desenvolvimento comunitário</li>
                        </ul>
                        <a href="#contato" class="btn btn-primary" style="margin-top:20px;">Solicitar Ajuda</a>
                    </div>
                    <div class="feature-image">
                        <div style="width:100%;height:300px;background:linear-gradient(135deg, #48bb78 0%, #38a169 100%);display:flex;align-items:center;justify-content:center;color:white;font-size:1.5rem;text-align:center;padding:20px;">
                            Ajuda Comunitária
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

<section id="blog">
    <div class="container">
        <div class="section-title">
            <h2>Notícias e Ações</h2>
            <p>Fique por dentro das nossas últimas atividades e campanhas</p>
        </div>
        
        <div class="cards" style="grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));">
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-tshirt"></i>
                </div>
                <div class="blog-meta" style="display: flex; gap: 15px; margin-bottom: 15px; font-size: 0.9rem; color: var(--gray);">
                    <span><i class="far fa-calendar"></i> 15 Ago, 2025</span>
                    <span><i class="far fa-user"></i> Por Rotasol</span>
                </div>
                <h3>Campanha do Agasalho 2025: Resultados Incríveis</h3>
                <p>Nossa campanha arrecadou mais de 5.000 peças de roupa que foram distribuídas para comunidades carentes em todo o estado.</p>
                
                    
                </a>
            </div>
            
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-route"></i>
                </div>
                <div class="blog-meta" style="display: flex; gap: 15px; margin-bottom: 15px; font-size: 0.9rem; color: var(--gray);">
                    <span><i class="far fa-calendar"></i> 10 Ago, 2025</span>
                    <span><i class="far fa-user"></i> Por Rotasol</span>
                </div>
                <h3>Expandindo Nossas Rotas: Novo Ponto no Interior</h3>
                <p>Inauguramos um novo ponto de coleta em região rural, ampliando nosso alcance para comunidades isoladas e de difícil acesso.</p>
                
                    
                </a>
            </div>
            
            <div class="card">
                <div class="card-icon">
                    <i class="fas fa-handshake"></i>
                </div>
                <div class="blog-meta" style="display: flex; gap: 15px; margin-bottom: 15px; font-size: 0.9rem; color: var(--gray);">
                    <span><i class="far fa-calendar"></i> 5 Ago, 2025</span>
                    <span><i class="far fa-user"></i> Por Rotasol</span>
                </div>
                <h3>Nova Parceria com Supermercados Locais</h3>
                <p>Firmamos parceria com rede de supermercados para coleta de alimentos próximos do vencimento, reduzindo desperdício.</p>
                
                    
                </a>
            </div>
        </div>
    </section>

    <section id="estoque">
        <div class="container">
            <div class="section-title">
                <h2>Painel de Estoque</h2>
                <p>Monitoramento em tempo real das doações recebidas</p>
            </div>
            
            <div class="dashboard-container">
                <div class="stats-grid">
                    <div class="stat-card primary">
                        <div class="stat-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="stat-content">
                            <h3  id="totalItens">0</h3>
                            <p>Total de Itens</p>
                            <span class="stat-trend" id="trendItens">
                                <i class="fas fa-arrow-up"></i>
                                <span>0%</span>
                            </span>
                        </div>
                    </div>
                    
                    <div class="stat-card success">
                        <div class="stat-icon">
                            <i class="fas fa-list-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="totalCategorias">0</h3>
                            <p>Categorias Ativas</p>
                            <span class="stat-trend">
                                <i class="fas fa-check"></i>
                                <span>Atualizado</span>
                            </span>
                        </div>
                    </div>
                    
                    <div class="stat-card warning">
                        <div class="stat-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="itensCriticos">0</h3>
                            <p>Itens em Alerta</p>
                            <span class="stat-trend">
                                <i class="fas fa-clock"></i>
                                <span>Necessitam doações</span>
                            </span>
                        </div>
                    </div>
                    
                    <div class="stat-card info">
                        <div class="stat-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="ultimaAtualizacao">-</h3>
                            <p>Última Atualização</p>
                            <span class="stat-trend">
                                <i class="fas fa-bolt"></i>
                                <span>Tempo real</span>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="dashboard-main">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Distribuição por Categoria</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" data-chart="pie">
                                    <i class="fas fa-chart-pie"></i>
                                </button>
                                <button class="chart-btn" data-chart="bar">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                                <button class="chart-btn" data-chart="line">
                                    <i class="fas fa-chart-line"></i>
                                </button>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <canvas id="estoqueChart" width="400" height="250"></canvas>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <div class="table-header">
                            <h3>Estoque Detalhado</h3>
                            <div class="table-actions">
                                <button class="action-btn" id="refreshEstoque">
                                    <i class="fas fa-redo"></i>
                                    Atualizar
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table id="tabelaEstoque">
                                <thead>
                                    <tr>
                                        <th>
                                            <i class="fas fa-tag"></i>
                                            Categoria
                                        </th>
                                        <th>
                                            <i class="fas fa-hashtag"></i>
                                            Quantidade
                                        </th>
                                        <th>
                                            <i class="fas fa-ruler"></i>
                                            Unidade
                                        </th>
                                        <th>
                                            <i class="fas fa-signal"></i>
                                            Status
                                        </th>
                                        <th>
                                            <i class="fas fa-percentage"></i>
                                            
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="estoqueTbody">
                                    <tr>
                                        <td colspan="6" class="loading-text">
                                            <i class="fas fa-spinner fa-spin"></i>
                                            Carregando estoque...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="dashboard-footer">
                    <div class="legend">
                        <h4>Legenda de Status:</h4>
                        <div class="legend-items">
                            <div class="legend-item">
                                <span class="status-dot excellent"></span>
                                <span>Excelente (> 50 itens)</span>
                            </div>
                            <div class="legend-item">
                                <span class="status-dot good"></span>
                                <span>Bom (11-50 itens)</span>
                            </div>
                            <div class="legend-item">
                                <span class="status-dot low"></span>
                                <span>Baixo (1-10 itens)</span>
                            </div>
                            <div class="legend-item">
                                <span class="status-dot critical"></span>
                                <span>Crítico (0 itens)</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="last-update">
                        <p><i class="fas fa-info-circle"></i> Atualizado automaticamente a cada 30 segundos</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="faq">
        <div class="container">
            <div class="section-title">
                <h2>Perguntas Frequentes</h2>
                <p>Tire suas dúvidas sobre a Rotasol</p>
            </div>
            
            <div class="faq-container">
                <div class="faq-item">
                    <div class="faq-question">
                        <span>Que tipos de doação são aceitas?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Aceitamos alimentos não perecíveis, roupas em bom estado, calçados, produtos de higiene pessoal, cobertores e brinquedos. Não aceitamos medicamentos, produtos perecíveis ou itens em mau estado.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>Como minha doação chega às comunidades?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Nossa equipe coleta as doações nos pontos de coleta, organiza por tipo e necessidade, e as distribui para comunidades cadastradas através de uma logística cuidadosamente planejada.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>Posso acompanhar o destino da minha doação?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Sim! Ao fazer sua doação, você recebe um código de rastreamento que permite acompanhar o destino final da sua contribuição através do nosso site.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">
                        <span>Como minha comunidade pode receber ajuda?</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Comunidades podem se cadastrar em nosso sistema através do formulário de contato. Nossa equipe entrará em contato para avaliar as necessidades e incluir a comunidade em nossas rotas de distribuição.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="contato">
        <div class="container">
            <div class="section-title">
                <h2>Entre em Contato</h2>
                <p>Tem dúvidas ou quer participar? Fale conosco!</p>
            </div>
            
            <div class="contact-container">
                <div class="contact-info">
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="contact-text">
                            <h3>Endereço</h3>
                            <p>Av. Paulista, 1000 - São Paulo, SP</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="contact-text">
                            <h3>Telefone</h3>
                            <p>(11) 99999-9999</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="contact-text">
                            <h3>Email</h3>
                            <p>contato@rotasol.com</p>
                        </div>
                    </div>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="contact-text">
                            <h3>Horário de Atendimento</h3>
                            <p>Segunda a Sexta: 8h às 18h</p>
                        </div>
                    </div>
                </div>
                
                <div class="contact-form">
                    <form id="contactForm">
                        <div class="form-group">
                            <label for="name">Nome Completo</label>
                            <input type="text" id="name" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="subject">Assunto</label>
                            <select id="subject" class="form-control" required>
                                <option value="">Selecione um assunto</option>
                                <option value="doacao">Quero fazer uma doação</option>
                                <option value="comunidade">Minha comunidade precisa de ajuda</option>
                                <option value="voluntario">Quero ser voluntário</option>
                                <option value="parceria">Proposta de parceria</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="message">Mensagem</label>
                            <textarea id="message" class="form-control" required></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width:100%;">Enviar Mensagem</button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>Rotasol</h3>
                    <p>Transportadora solidária conectando doadores e comunidades necessitadas através de uma rede de transporte eficiente e compassiva.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h3>Links Rápidos</h3>
                    <ul class="footer-links">
                        <li><a href="#home"><i class="fas fa-chevron-right"></i> Início</a></li>
                        <li><a href="#sobre"><i class="fas fa-chevron-right"></i> Sobre</a></li>
                        <li><a href="#mapa"><i class="fas fa-chevron-right"></i> Pontos de Coleta</a></li>
                        <li><a href="#funcionalidades"><i class="fas fa-chevron-right"></i> Como Funciona</a></li>
                        <li><a href="#contato"><i class="fas fa-chevron-right"></i> Contato</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Rotasol. Desenvolvido por <strong>308 Studios</strong>. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

<div id="loadingScreen" style="
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #4a6cf7 0%, #6e8efb 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    color: white;
    font-family: 'Poppins', sans-serif;">
    <div style="text-align: center;">
        <img src="caminhao2-unscreen.gif" alt="Carregando..." style="width:200px;height:auto;margin-bottom:20px;">
        <h2 style="margin-bottom: 10px;">Rotasol</h2>
        <p>Conectando com a rede solidária...</p>
        <div style="width: 100px; height: 4px; background: rgba(255,255,255,0.3); margin: 20px auto; border-radius: 2px; overflow: hidden;">
            <div id="loadingBar" style="height: 100%; background: #ffce3e; width: 0%; transition: width 0.3s;"></div>
        </div>
    </div>
</div>



    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
let map;
let userMarker;
let pontosColeta = [];

let estoqueChart = null;
let estoqueData = [];


document.addEventListener('DOMContentLoaded', function() {
    const loadingScreen = document.getElementById('loadingScreen');
    const loadingBar = document.getElementById('loadingBar');
    
    let progress = 0;
    const interval = setInterval(() => {
        progress += 10;
        loadingBar.style.width = progress + '%';
        
        if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
                loadingScreen.style.display = 'none';
                checkUserLogin();
                initMap();
                setTimeout(() => {
                    loadEstoqueGeral();
                    setupEstoqueEvents();
                    setupContactForm();
                }, 1500);
            }, 500);
        }
    }, 200);
});

function setupContactForm() {
    const contactForm = document.getElementById('contactForm');
    if (contactForm) {
        contactForm.addEventListener('submit', handleContactSubmit);
        console.log('✅ Formulário de contato configurado');
    } else {
        console.log('❌ Formulário de contato não encontrado');
    }
}

function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function validateContactForm(formData) {
    const errors = [];

    if (!formData.name.trim()) {
        errors.push('Nome é obrigatório');
    }

    if (!formData.email.trim()) {
        errors.push('Email é obrigatório');
    } else if (!isValidEmail(formData.email)) {
        errors.push('Email inválido');
    }

    if (!formData.subject || formData.subject === '') {
        errors.push('Assunto é obrigatório');
    }

    if (!formData.message.trim()) {
        errors.push('Mensagem é obrigatória');
    } else if (formData.message.trim().length < 10) {
        errors.push('Mensagem deve ter pelo menos 10 caracteres');
    }

    return errors;
}

async function handleContactSubmit(e) {
    e.preventDefault();
    
    const submitBtn = e.target.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;

    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
    
    const formData = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        subject: document.getElementById('subject').value,
        message: document.getElementById('message').value
    };

    const errors = validateContactForm(formData);
    if (errors.length > 0) {
        showNotificacao(errors[0], 'error');
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
        return;
    }

    try {
        const response = await fetch('/api/contato', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (data.success) {
            showNotificacao(data.message, 'success');
            document.getElementById('contactForm').reset();
        } else {
            showNotificacao(data.error || 'Erro ao enviar mensagem', 'error');
        }
    } catch (error) {
        console.error('Erro:', error);
        showNotificacao('Erro de conexão. Tente novamente.', 'error');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalText;
    }
}

function initMap() {
    map = L.map('map').setView([-14.2350, -51.9253], 4);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    loadPontosColeta();

    setupMapEvents();
}

async function loadPontosColeta() {
    try {
        const response = await fetch('/api/pontos-coleta');
        pontosColeta = await response.json();
        pontosColeta.forEach(ponto => {
            if (ponto.latitude && ponto.longitude) {
                const marker = L.marker([parseFloat(ponto.latitude), parseFloat(ponto.longitude)])
                    .addTo(map)
                    .bindPopup(`
                        <strong>${ponto.nome}</strong><br>
                        ${ponto.endereco}<br>
                        <small>${ponto.descricao || ''}</small>
                    `);
                addPontoToList(ponto);
            }
        });
    } catch (error) {
        console.error('Erro ao carregar pontos de coleta:', error);
        loadPontosExemplo();
    }
}
function loadPontosExemplo() {
    const pontosExemplo = [
        {
            id: 1,
            nome: "Ponto Central - Criciúma",
            endereco: "Rua das Flores, 123 - Centro, Criciúma/SC",
            latitude: -28.6785,
            longitude: -49.3690,
            descricao: "Posto de coleta 24h"
        },
        {
            id: 2,
            nome: "Ponto Içara",
            endereco: "Av. Central, 456 - Jardim, Içara/SC",
            latitude: -28.7132,
            longitude: -49.3087,
            descricao: "Aberto das 8h às 18h"
        },
        {
            id: 3,
            nome: "Ponto Araranguá",
            endereco: "Rodovia do Sol, 789 - Sul, Araranguá/SC",
            latitude: -28.9357,
            longitude: -49.4914,
            descricao: "Posto de coleta 24h"
        }
    ];

    pontosExemplo.forEach(ponto => {
        const marker = L.marker([ponto.latitude, ponto.longitude])
            .addTo(map)
            .bindPopup(`
                <strong>${ponto.nome}</strong><br>
                ${ponto.endereco}<br>
                <small>${ponto.descricao}</small>
            `);
        
        addPontoToList(ponto);
    });

    pontosColeta = pontosExemplo;
}
function addPontoToList(ponto) {
    const listaPontos = document.getElementById('listaPontos');
    const pontoItem = document.createElement('div');
    pontoItem.className = 'ponto-item';
    pontoItem.innerHTML = `
        <i class="fas fa-map-marker-alt"></i>
        <div class="ponto-info">
            <h5>${ponto.nome}</h5>
            <p>${ponto.endereco}</p>
            <small>${ponto.descricao || ''}</small>
        </div>
    `;
    
    pontoItem.addEventListener('click', () => {
        if (ponto.latitude && ponto.longitude) {
            map.setView([parseFloat(ponto.latitude), parseFloat(ponto.longitude)], 15);
            map.eachLayer(layer => {
                if (layer instanceof L.Marker) {
                    const latLng = layer.getLatLng();
                    if (latLng.lat === parseFloat(ponto.latitude) && 
                        latLng.lng === parseFloat(ponto.longitude)) {
                        layer.openPopup();
                    }
                }
            });
        }
    });
    
    listaPontos.appendChild(pontoItem);
}

function setupMapEvents() {
    document.getElementById('buscarEndereco').addEventListener('click', buscarEndereco);
    
    document.getElementById('usarLocalizacao').addEventListener('click', usarLocalizacaoAtual);
    
    document.getElementById('enderecoInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            buscarEndereco();
        }
    });
    
    setupAutocomplete();
}

function setupAutocomplete() {
    const enderecoInput = document.getElementById('enderecoInput');
    const autocompleteResults = document.getElementById('autocompleteResults');
    
    if (!enderecoInput) return;
    
    enderecoInput.addEventListener('focus', function() {
        const query = this.value.trim();
        if (query.length >= 2) {
            searchAddresses(query);
        }
    });
    enderecoInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();

        if (autocompleteTimeout) {
            clearTimeout(autocompleteTimeout);
        }
        
        if (query.length === 0) {
            autocompleteResults.classList.remove('active');
            autocompleteResults.innerHTML = '';
            return;
        }
        
        if (query.length < 2) {
            autocompleteResults.classList.remove('active');
            return;
        }
        autocompleteResults.innerHTML = `
            <div class="autocomplete-item">
                <i class="fas fa-spinner fa-spin"></i>
                <div class="autocomplete-text">
                    <div class="autocomplete-title">Buscando...</div>
                    <div class="autocomplete-address">Procurando por "${query}"</div>
                </div>
            </div>
        `;
        autocompleteResults.classList.add('active');
        autocompleteTimeout = setTimeout(() => {
            searchAddresses(query);
        }, 500);
    });

    enderecoInput.addEventListener('keydown', function(e) {
        const items = autocompleteResults.querySelectorAll('.autocomplete-item');
        const activeItem = autocompleteResults.querySelector('.autocomplete-item.active');
        let currentIndex = Array.from(items).indexOf(activeItem);
        
        switch(e.key) {
            case 'ArrowDown':
                e.preventDefault();
                if (items.length > 0) {
                    if (currentIndex < items.length - 1) {
                        items.forEach(item => item.classList.remove('active'));
                        items[currentIndex + 1].classList.add('active');
                    } else {
                        items.forEach(item => item.classList.remove('active'));
                        items[0].classList.add('active');
                    }
                }
                break;
                
            case 'ArrowUp':
                e.preventDefault();
                if (items.length > 0) {
                    if (currentIndex > 0) {
                        items.forEach(item => item.classList.remove('active'));
                        items[currentIndex - 1].classList.add('active');
                    } else {
                        items.forEach(item => item.classList.remove('active'));
                        items[items.length - 1].classList.add('active');
                    }
                }
                break;
                
            case 'Enter':
                if (activeItem) {
                    e.preventDefault();
                    activeItem.click();
                } else {
                    buscarEndereco();
                    autocompleteResults.classList.remove('active');
                }
                break;
                
            case 'Escape':
                autocompleteResults.classList.remove('active');
                break;
        }
    });
    document.addEventListener('click', function(e) {
        if (!enderecoInput.contains(e.target) && !autocompleteResults.contains(e.target)) {
            autocompleteResults.classList.remove('active');
        }
    });
}
async function searchAddresses(query) {
    try {
        console.log('🔍 Buscando endereços para:', query);
        
        const response = await fetch(
            `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query + ', Brasil')}&countrycodes=br&limit=8&addressdetails=1`
        );
        const data = await response.json();
        
        console.log('📋 Resultados encontrados:', data.length);
        displayAutocompleteResults(data, query);
    } catch (error) {
        console.error('❌ Erro no autocomplete:', error);
        displayAutocompleteResults([], query);
    }
}
function displayAutocompleteResults(results, query) {
    const autocompleteResults = document.getElementById('autocompleteResults');
    
    if (results.length === 0) {
        autocompleteResults.innerHTML = `
            <div class="autocomplete-item">
                <i class="fas fa-search"></i>
                <div class="autocomplete-text">
                    <div class="autocomplete-title">Nenhum resultado encontrado</div>
                    <div class="autocomplete-address">Tente buscar por "${query}" de outra forma</div>
                </div>
            </div>
        `;
        autocompleteResults.classList.add('active');
        return;
    }
    
    let html = '';
    
    results.forEach((result, index) => {
        const displayName = formatDisplayName(result);
        const addressType = getAddressType(result);
        const icon = getAddressIcon(result);
        
        html += `
            <div class="autocomplete-item ${index === 0 ? 'active' : ''}" data-lat="${result.lat}" data-lon="${result.lon}" data-address="${result.display_name}">
                <i class="${icon}"></i>
                <div class="autocomplete-text">
                    <div class="autocomplete-title">${displayName.name}</div>
                    <div class="autocomplete-address">${displayName.address}</div>
                </div>
            </div>
        `;
    });
    html += `
        <div class="autocomplete-item" data-search="${query}">
            <i class="fas fa-external-link-alt"></i>
            <div class="autocomplete-text">
                <div class="autocomplete-title">Buscar no Google Maps</div>
                <div class="autocomplete-address">Pesquisar por "${query}"</div>
            </div>
        </div>
    `;
    
    autocompleteResults.innerHTML = html;
    autocompleteResults.classList.add('active');
    setupAutocompleteItems();
}

function formatDisplayName(result) {
    const parts = result.display_name.split(',');
    const name = parts[0].trim();
    const address = parts.slice(1, 3).join(', ').trim();
    
    return {
        name: name,
        address: address || result.display_name
    };
}
function getAddressType(result) {
    if (result.type === 'city' || result.type === 'town') return 'city';
    if (result.type === 'village' || result.type === 'hamlet') return 'village';
    if (result.type === 'road' || result.type === 'street') return 'road';
    return 'place';
}
function getAddressIcon(result) {
    switch(getAddressType(result)) {
        case 'city': return 'fas fa-city';
        case 'village': return 'fas fa-home';
        case 'road': return 'fas fa-road';
        default: return 'fas fa-map-marker-alt';
    }
}
async function calculateRouteToNearestPoint(startCoords) {
    if (!pontosColeta || pontosColeta.length === 0) {
        console.log('❌ Nenhum ponto de coleta disponível');
        showNotificacao('Nenhum ponto de coleta cadastrado', 'warning');
        return;
    }
    
    console.log('🧮 Calculando rota para ponto mais próximo...', startCoords);
    let nearestPoint = null;
    let minDistance = Infinity;
    
    pontosColeta.forEach(ponto => {
        if (ponto.latitude && ponto.longitude) {
            const distance = calculateDistance(
                startCoords[0], startCoords[1],
                parseFloat(ponto.latitude), parseFloat(ponto.longitude)
            );
            
            if (distance < minDistance) {
                minDistance = distance;
                nearestPoint = ponto;
            }
        }
    });
    
    if (!nearestPoint) {
        console.log('❌ Nenhum ponto de coleta válido encontrado');
        showNotificacao('Nenhum ponto de coleta próximo encontrado', 'warning');
        return;
    }
    
    console.log('📍 Ponto mais próximo encontrado:', nearestPoint.nome, 'Distância:', minDistance.toFixed(0) + 'm');
    const routeInfo = document.getElementById('routeInfo');
    routeInfo.innerHTML = `
        <div class="route-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Calculando melhor rota para:<br><strong>${nearestPoint.nome}</strong></p>
        </div>
    `;
    routeInfo.classList.add('active');
    
    try {
        const startLonLat = `${startCoords[1]},${startCoords[0]}`;
        const endLonLat = `${parseFloat(nearestPoint.longitude)},${parseFloat(nearestPoint.latitude)}`;
        
        const url = `https://router.project-osrm.org/route/v1/driving/${startLonLat};${endLonLat}?overview=full&geometries=geojson`;
        
        console.log(' Chamando API de roteamento:', url);
        
        const response = await fetch(url);
        const data = await response.json();
        
        console.log('📊 Resposta da API:', data);
        
        if (data.routes && data.routes.length > 0) {
            const route = data.routes[0];
            console.log('✅ Rota calculada:', {
                distancia: (route.distance / 1000).toFixed(1) + ' km',
                tempo: formatTime(route.duration)
            });
            
            displayRoute(route, startCoords, nearestPoint);
        } else {
            throw new Error('Rota não encontrada na API');
        }
    } catch (error) {
        console.error('❌ Erro ao calcular rota:', error);
        showNotificacao('Usando cálculo de rota simplificado', 'info');
        calculateSimpleRoute(startCoords, nearestPoint);
    }
}
function calculateSimpleRoute(startCoords, nearestPoint) {
    const distance = calculateDistance(
        startCoords[0], startCoords[1],
        parseFloat(nearestPoint.latitude), parseFloat(nearestPoint.longitude)
    );
    
    const time = calculateTime(distance, 'driving');
    
    displayRouteInfo({
        distance: (distance / 1000).toFixed(1) + ' km',
        time: time,
        type: 'carro'
    });
    drawSimpleRoute(startCoords, [parseFloat(nearestPoint.latitude), parseFloat(nearestPoint.longitude)]);
}

function drawSimpleRoute(startCoords, endCoords) {
    clearRoute();

    currentRoute = L.polyline([startCoords, endCoords], {
        color: '#4a6cf7',
        weight: 5,
        opacity: 0.7,
        dashArray: '10, 10'
    }).addTo(map);

    L.marker(startCoords, {
        icon: L.divIcon({
            className: 'route-marker start-marker',
            html: '<i class="fas fa-play" style="color: white; font-size: 8px;"></i>',
            iconSize: [18, 18]
        })
    }).addTo(map).bindPopup('Sua localização');
    
    map.eachLayer(layer => {
        if (layer instanceof L.Marker) {
            const latLng = layer.getLatLng();
            if (latLng.lat === endCoords[0] && latLng.lng === endCoords[1]) {
                layer.openPopup();
            }
        }
    });
}

function displayRoute(route, startCoords, nearestPoint) {
    const distance = (route.distance / 1000).toFixed(1);
    const time = formatTime(route.duration);
    
    displayRouteInfo({
        distance: distance + ' km',
        time: time,
        type: 'carro'
    });
    
    drawRouteOnMap(route.geometry.coordinates, startCoords, nearestPoint);
}

function displayRouteInfo(routeInfo) {
    const routeInfoElement = document.getElementById('routeInfo');
    routeInfoElement.innerHTML = `
        <h4><i class="fas fa-route"></i> Rota para o Ponto Mais Próximo</h4>
        <div class="route-details">
            <div class="route-detail">
                <i class="fas fa-road"></i>
                <div class="value">${routeInfo.distance}</div>
                <div class="label">Distância</div>
            </div>
            <div class="route-detail">
                <i class="fas fa-clock"></i>
                <div class="value">${routeInfo.time}</div>
                <div class="label">Tempo</div>
            </div>
            <div class="route-detail">
                <i class="fas fa-walking"></i>
                <div class="value">${routeInfo.type}</div>
                <div class="label">Modalidade</div>
            </div>
        </div>
        
    `;
    routeInfoElement.classList.add('active');
    
    document.getElementById('startNavigation').addEventListener('click', startNavigation);
    document.getElementById('clearRoute').addEventListener('click', clearRoute);
}

function drawRouteOnMap(coordinates, startCoords, nearestPoint) {

    clearRoute();
    
    console.log('🎯 Desenhando rota no mapa...', {
        coordenadas: coordinates.length,
        inicio: startCoords,
        destino: nearestPoint
    });
    
    const routeCoordinates = coordinates.map(coord => [coord[1], coord[0]]);
    
    console.log('📐 Coordenadas convertidas:', routeCoordinates.length);
    
    currentRoute = L.polyline(routeCoordinates, {
        color: '#4a6cf7',
        weight: 6,
        opacity: 0.8,
        dashArray: '10, 10',
        lineCap: 'round'
    }).addTo(map);
    
    const startMarker = L.marker(startCoords, {
        icon: L.divIcon({
            className: 'route-marker start-marker',
            html: '<i class="fas fa-user" style="color: white; font-size: 8px;"></i>',
            iconSize: [20, 20],
            iconAnchor: [10, 10]
        })
    }).addTo(map).bindPopup('<strong>📍 Sua localização</strong>');
    
    const destMarker = L.marker([parseFloat(nearestPoint.latitude), parseFloat(nearestPoint.longitude)], {
        icon: L.divIcon({
            className: 'route-marker dest-marker',
            html: '<i class="fas fa-flag" style="color: white; font-size: 8px;"></i>',
            iconSize: [20, 20],
            iconAnchor: [10, 10]
        })
    }).addTo(map).bindPopup(`<strong>🎯 ${nearestPoint.nome}</strong><br>${nearestPoint.endereco}`);
    
    currentRoute.markers = [startMarker, destMarker];
    
    const routeBounds = currentRoute.getBounds();
    map.fitBounds(routeBounds, { padding: [50, 50] });
    
    console.log('✅ Rota desenhada com sucesso!');
}
function startNavigation() {
    if (!currentRoute) {
        showNotificacao('Nenhuma rota calculada', 'warning');
        return;
    }
    
    showNotificacao('Navegação iniciada - Siga a rota destacada no mapa', 'success');
    
    const routeBounds = currentRoute.getBounds();
    map.fitBounds(routeBounds, { padding: [20, 20] });
}

function clearRoute() {
    console.log('🗑️ Limpando rota...');
    
    if (currentRoute) {
        map.removeLayer(currentRoute);
       
        if (currentRoute.markers && Array.isArray(currentRoute.markers)) {
            currentRoute.markers.forEach(marker => {
                if (marker && map.hasLayer(marker)) {
                    map.removeLayer(marker);
                }
            });
        }
        
        currentRoute = null;
        console.log('✅ Rota removida do mapa');
    }
    
    const routeInfo = document.getElementById('routeInfo');
    if (routeInfo) {
        routeInfo.classList.remove('active');
        console.log('✅ Informações da rota ocultadas');
    }
    
    map.closePopup();
}

function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = 
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
        Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

function calculateTime(distance, type) {
    let speed;
    switch(type) {
        case 'walking': speed = 5; break;
        case 'cycling': speed = 15; break;
        default: speed = 40;
    }
    
    const timeHours = distance / 1000 / speed;
    return formatTime(timeHours * 3600);
}

function formatTime(seconds) {
    if (seconds < 60) {
        return '< 1 min';
    } else if (seconds < 3600) {
        return Math.round(seconds / 60) + ' min';
    } else {
        const hours = Math.floor(seconds / 3600);
        const minutes = Math.round((seconds % 3600) / 60);
        return hours + 'h ' + (minutes > 0 ? minutes + 'min' : '');
    }
}
async function buscarEndereco() {
    const enderecoInput = document.getElementById('enderecoInput').value.trim();
    
    if (!enderecoInput) {
        alert('Por favor, digite um endereço.');
        return;
    }

    try {
        const response = await fetch(
            `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(enderecoInput)}&limit=1&countrycodes=br`
        );
        const data = await response.json();
        
        if (data.length > 0) {
            const lat = parseFloat(data[0].lat);
            const lon = parseFloat(data[0].lon);
            
            map.setView([lat, lon], 15);
            
            if (userMarker) {
                map.removeLayer(userMarker);
            }
            
            userMarker = L.marker([lat, lon])
                .addTo(map)
                .bindPopup('Sua localização: ' + enderecoInput)
                .openPopup();
                
            userLocation = [lat, lon];
            
            salvarLocalizacaoUsuario(enderecoInput, lat, lon);
            
            calculateRouteToNearestPoint(userLocation);
            
        } else {
            alert('Endereço não encontrado. Tente novamente.');
        }
    } catch (error) {
        console.error('Erro ao buscar endereço:', error);
        alert('Erro ao buscar endereço. Tente novamente.');
    }
}

function usarLocalizacaoAtual() {
    if (!navigator.geolocation) {
        alert('Geolocalização não suportada pelo seu navegador.');
        return;
    }

    navigator.geolocation.getCurrentPosition(
        async (position) => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            
            map.setView([lat, lon], 15);
            
            if (userMarker) {
                map.removeLayer(userMarker);
            }
            
            userMarker = L.marker([lat, lon])
                .addTo(map)
                .bindPopup('Sua localização atual')
                .openPopup();
                
            userLocation = [lat, lon];
            
            try {
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
                );
                const data = await response.json();
                
                const endereco = data.display_name || 'Localização atual';
                userMarker.setPopupContent('Sua localização: ' + endereco);
                document.getElementById('enderecoInput').value = endereco;
                
                salvarLocalizacaoUsuario(endereco, lat, lon);
                
            } catch (error) {
                console.error('Erro ao obter endereço:', error);
                salvarLocalizacaoUsuario('Localização por GPS', lat, lon);
            }
            
            calculateRouteToNearestPoint(userLocation);
        },
        (error) => {
            console.error('Erro de geolocalização:', error);
            alert('Não foi possível obter sua localização. Verifique as permissões do navegador.');
        }
    );
}
async function salvarLocalizacaoUsuario(endereco, latitude, longitude) {
    const token = localStorage.getItem('token');
    
    if (!token) {
        console.log('Usuário não logado - localização não salva');
        return;
    }

    try {
        const response = await fetch('/api/salvar-localizacao', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify({
                endereco: endereco,
                latitude: latitude,
                longitude: longitude
            })
        });

        if (response.ok) {
            console.log('Localização salva com sucesso');
        } else {
            console.error('Erro ao salvar localização');
        }
    } catch (error) {
        console.error('Erro ao salvar localização:', error);
    }
}

async function checkUserLogin() {
    const token = localStorage.getItem('token');
    const loginBtn = document.getElementById('loginBtn');

    if (token) {
        try {
            const res = await fetch('/api/me', {
                headers: { Authorization: 'Bearer ' + token }
            });
            
            if (res.ok) {
                const user = await res.json();
                
                const resDoacoes = await fetch('/api/minhas-doacoes', {
                    headers: { Authorization: 'Bearer ' + token }
                });
                
                let totalDoacoes = 0;
                if (resDoacoes.ok) {
                    const doacoesData = await resDoacoes.json();
                    totalDoacoes = doacoesData.total || 0;
                }

                loginBtn.outerHTML = `
                    <div class="user-menu">
                        <button id="userBtn" style="background: none; border: none; padding: 0; cursor: pointer;">
                            <img src="${user.foto_perfil || 'https://via.placeholder.com/32x32/4a6cf7/ffffff?text=U'}" alt="Foto" class="user-avatar">
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-header">
                                <img src="${user.foto_perfil || 'https://via.placeholder.com/50x50/4a6cf7/ffffff?text=U'}" alt="Foto" class="user-avatar-large">
                                <div>
                                    <p><strong>${user.nome_completo || user.usuario}</strong></p>
                                    <p>${user.email}</p>
                                </div>
                            </div>
                            <hr>
                            <p><strong>Doações este mês:</strong> ${totalDoacoes}</p>
                            <div style="margin: 15px 0;">
                                <button id="novaDoacaoBtn" class="btn btn-primary" style="width: 100%; margin-bottom: 10px;">
                                    <i class="fas fa-gift"></i> Nova Doação
                                </button>
                                <button id="verDoacoesBtn" class="btn btn-secondary" style="width: 100%;">
                                    <i class="fas fa-history"></i> Minhas Doações
                                </button>
                            </div>
                            <button id="editProfileBtn" class="btn btn-secondary" style="width: 100%; margin-top: 10px;">
                                <i class="fas fa-user-edit"></i> Editar Foto
                            </button>
                            <button id="logoutBtn" class="btn btn-secondary" style="width: 100%; margin-top: 10px;">Sair</button>
                        </div>
                    </div>
                `;
                setupUserMenu();
            }
        } catch (error) {
            console.error('Erro ao verificar login:', error);
        }
    }
}

function setupUserMenu() {
    const userBtn = document.getElementById('userBtn');
    const userDropdown = document.getElementById('userDropdown');
    const logoutBtn = document.getElementById('logoutBtn');
    const novaDoacaoBtn = document.getElementById('novaDoacaoBtn');
    const verDoacoesBtn = document.getElementById('verDoacoesBtn');
    const editProfileBtn = document.getElementById('editProfileBtn');

    userBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        userDropdown.style.display = userDropdown.style.display === 'block' ? 'none' : 'block';
    });

    logoutBtn.addEventListener('click', () => {
        localStorage.clear();
        window.location.reload();
    });

    if (novaDoacaoBtn) {
        novaDoacaoBtn.addEventListener('click', () => {
            showDoacaoModal();
            userDropdown.style.display = 'none';
        });
    }

    if (verDoacoesBtn) {
        verDoacoesBtn.addEventListener('click', () => {
            showMinhasDoacoes();
            userDropdown.style.display = 'none';
        });
    }

    if (editProfileBtn) {
        editProfileBtn.addEventListener('click', () => {
            showEditProfileModal();
            userDropdown.style.display = 'none';
        });
    }

    document.addEventListener('click', () => {
        userDropdown.style.display = 'none';
    });
}

function showDoacaoModal() {
    const modalHTML = `
        <div id="doacaoModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        ">
            <div style="
                background: var(--light);
                padding: 30px;
                border-radius: var(--radius);
                width: 90%;
                max-width: 500px;
                max-height: 90vh;
                overflow-y: auto;
            ">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">Nova Doação</h3>
                    <button id="closeModal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text);">&times;</button>
                </div>
                
                <form id="formDoacao">
                    <div class="form-group">
                        <label for="tipoDoacao">Tipo de Doação</label>
                        <select id="tipoDoacao" class="form-control" required>
                            <option value="">Selecione o tipo</option>
                            <option value="Alimentos não perecíveis">Alimentos não perecíveis</option>
                            <option value="Roupas">Roupas</option>
                            <option value="Calçados">Calçados</option>
                            <option value="Produtos de higiene">Produtos de higiene</option>
                            <option value="Brinquedos">Brinquedos</option>
                            <option value="Cobertores">Cobertores</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="quantidade">Quantidade</label>
                        <input type="number" id="quantidade" class="form-control" step="0.01" min="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="unidadeMedida">Unidade de Medida</label>
                        <select id="unidadeMedida" class="form-control" required>
                            <option value="unidades">Unidades</option>
                            <option value="kg">Quilogramas</option>
                            <option value="litros">Litros</option>
                            <option value="caixas">Caixas</option>
                            <option value="sacos">Sacos</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="localDoacao">Local de Entrega</label>
                        <select id="localDoacao" class="form-control" required>
                            <option value="">Selecione o local</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoes">Observações</label>
                        <textarea id="observacoes" class="form-control" rows="3" placeholder="Alguma informação adicional sobre a doação..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-paper-plane"></i> Registrar Doação
                    </button>
                </form>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    
    document.getElementById('closeModal').addEventListener('click', () => {
        document.getElementById('doacaoModal').remove();
    });
    
    document.getElementById('doacaoModal').addEventListener('click', (e) => {
        if (e.target.id === 'doacaoModal') {
            e.target.remove();
        }
    });
    
    loadLocaisDoacao();

    document.getElementById('formDoacao').addEventListener('submit', registrarDoacao);
}

async function loadLocaisDoacao() {
    try {
        const select = document.getElementById('localDoacao');
        select.innerHTML = '<option value="">Selecione o local</option>';
        
        pontosColeta.forEach(ponto => {
            const option = document.createElement('option');
            option.value = ponto.id;
            option.textContent = `${ponto.nome} - ${ponto.endereco}`;
            select.appendChild(option);
        });
    } catch (error) {
        console.error('Erro ao carregar locais:', error);
    }
}
async function registrarDoacao(e) {
    e.preventDefault();
    
    const token = localStorage.getItem('token');
    if (!token) {
        alert('Você precisa estar logado para fazer uma doação.');
        return;
    }
    
    const formData = {
        tipo_doacao: document.getElementById('tipoDoacao').value,
        quantidade: parseFloat(document.getElementById('quantidade').value),
        unidade_medida: document.getElementById('unidadeMedida').value,
        localizacao_id: parseInt(document.getElementById('localDoacao').value),
        observacoes: document.getElementById('observacoes').value
    };
    
    try {
        const response = await fetch('/api/doacoes', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + token
            },
            body: JSON.stringify(formData)
        });
        
        if (response.ok) {
            const result = await response.json();
            atualizarEstoqueAposDoacao(formData.tipo_doacao, formData.quantidade);
            if (result.conversao) {
                alert(`Doação registrada com sucesso!\n\n` +
                      `📦 ${result.conversao.quantidade_original} ${result.conversao.unidade_original} de ${result.conversao.tipo_doacao}\n` +
                      `📊 Equivale a: ${result.conversao.valor_estoque} ${result.conversao.unidade_estoque}`);
            } else {
                alert('Doação registrada com sucesso! Código: ' + result.codigo);
            }
            
            document.getElementById('doacaoModal').remove();
            checkUserLogin();
        } else {
            const error = await response.json();
            alert('Erro ao registrar doação: ' + error.error);
        }
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao conectar com o servidor.');
    }
}

async function showMinhasDoacoes() {
    const token = localStorage.getItem('token');
    if (!token) return;
    
    try {
        const response = await fetch('/api/minhas-doacoes', {
            headers: { 'Authorization': 'Bearer ' + token }
        });
        
        if (response.ok) {
            const data = await response.json();
            
            const modalHTML = `
                <div id="doacoesModal" style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                ">
                    <div style="
                        background: var(--light);
                        padding: 30px;
                        border-radius: var(--radius);
                        width: 90%;
                        max-width: 800px;
                        max-height: 90vh;
                        overflow-y: auto;
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3 style="margin: 0;">Minhas Doações</h3>
                            <button id="closeDoacoesModal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text);">&times;</button>
                        </div>
                        
                        <div style="margin-bottom: 20px; padding: 15px; background: var(--gray-light); border-radius: var(--radius);">
                            <p style="margin: 0;"><strong>Resumo do Mês:</strong> ${data.total} doações realizadas</p>
                        </div>
                        
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${data.doacoes.length > 0 ? 
                                data.doacoes.map(doacao => `
                                    <div style="padding: 15px; border-bottom: 1px solid var(--gray-light);">
                                        <div style="display: flex; justify-content: space-between; align-items: start;">
                                            <div>
                                                <strong>${doacao.tipo_doacao}</strong>
                                                <p style="margin: 5px 0; color: var(--gray);">${doacao.quantidade} ${doacao.unidade_medida}</p>
                                                <small>${new Date(doacao.data_doacao).toLocaleDateString('pt-BR')} - ${doacao.local_nome || 'Não especificado'}</small>
                                            </div>
                                            <span style="
                                                padding: 4px 8px;
                                                border-radius: 12px;
                                                font-size: 0.8rem;
                                                background: ${doacao.status === 'confirmada' ? 'var(--success)' : 
                                                             doacao.status === 'entregue' ? 'var(--primary)' : 'var(--warning)'};
                                                color: white;
                                            ">${doacao.status || 'pendente'}</span>
                                        </div>
                                        ${doacao.observacoes ? `<p style="margin-top: 10px; font-style: italic;">${doacao.observacoes}</p>` : ''}
                                    </div>
                                `).join('') : 
                                '<p style="text-align: center; color: var(--gray);">Nenhuma doação registrada ainda.</p>'
                            }
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
            
            document.getElementById('closeDoacoesModal').addEventListener('click', () => {
                document.getElementById('doacoesModal').remove();
            });
            
            document.getElementById('doacoesModal').addEventListener('click', (e) => {
                if (e.target.id === 'doacoesModal') {
                    e.target.remove();
                }
            });
        }
    } catch (error) {
        console.error('Erro ao carregar doações:', error);
    }
}

async function loadEstoqueGeral() {
    try {
        console.log('🌐 Carregando estoque geral...');
        const response = await fetch('/api/estoque-geral');
        
        if (response.ok) {
            const estoque = await response.json();
            console.log('✅ Dados do estoque carregados:', estoque);
            
            estoqueData = estoque;
            updateDashboard(estoque);
            updateChart(estoque);
        } else {
            throw new Error('API retornou erro: ' + response.status);
        }
    } catch (error) {
        console.error('❌ Erro ao carregar estoque:', error);
        const estoqueExemplo = [
            { tipo_item: 'Cobertores', quantidade_total: 25, unidade_medida: 'unidades' },
            { tipo_item: 'Alimentos não perecíveis', quantidade_total: 150, unidade_medida: 'kg' },
            { tipo_item: 'Roupas', quantidade_total: 80, unidade_medida: 'unidades' },
            { tipo_item: 'Produtos de higiene', quantidade_total: 35, unidade_medida: 'unidades' },
            { tipo_item: 'Brinquedos', quantidade_total: 42, unidade_medida: 'unidades' }
        ];
        estoqueData = estoqueExemplo;
        updateDashboard(estoqueExemplo);
        updateChart(estoqueExemplo);
        showNotificacao('Usando dados de demonstração', 'warning');
    }
}
function updateDashboard(estoque) {
    updateTabelaEstoque(estoque);
    updateEstatisticas(estoque);
}
function updateTabelaEstoque(estoque) {
    const tbody = document.getElementById('estoqueTbody');
    
    if (!tbody) {
        console.error('❌ Elemento estoqueTbody não encontrado');
        return;
    }
    
    if (estoque.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="loading-text">
                    <i class="fas fa-box-open"></i>
                    Nenhum item em estoque
                </td>
            </tr>
        `;
        return;
    }
    const totalItens = estoque.reduce((sum, item) => {
        const quantidade = Number(item.quantidade_total) || 0;
        return sum + quantidade;
    }, 0);
    
    let html = '';
    estoque.forEach(item => {
        const quantidade = Number(item.quantidade_total) || 0;
        const status = getStatusEstoque(quantidade);
        const porcentagem = totalItens > 0 ? (quantidade / totalItens * 100).toFixed(1) : 0;
        
        html += `
            <tr class="fade-in-up">
                <td>
                    <i class="fas ${getIconeItem(item.tipo_item)}" style="color: var(--primary); margin-right: 8px;"></i>
                    <strong>${item.tipo_item}</strong>
                </td>
                <td>
                    <span style="font-weight: 600; color: var(--dark);">${quantidade.toLocaleString('pt-BR')}</span>
                </td>
                <td>${item.unidade_medida || 'unidades'}</td>
                <td>
                    <div class="status-cell">
                        <span class="status-dot ${status}"></span>
                        <span>${getStatusText(status)}</span>
                    </div>
                </td>
                <td>
                    <div class="progress-cell">
                        <div class="progress-bar">
                            <div class="progress-fill ${status}" style="width: ${porcentagem}%"></div>
                        </div>
                        <span style="font-size: 0.8rem; color: var(--gray); min-width: 35px;">${porcentagem}%</span>
                    </div>
                </td>
            </tr>
        `;
    });
    
    tbody.innerHTML = html;
}
function updateEstatisticas(estoque) {
    const totalItens = estoque.reduce((sum, item) => {
        const quantidade = Number(item.quantidade_total) || 0;
        return sum + quantidade;
    }, 0);
    
    const totalCategorias = estoque.length;
    const itensCriticos = estoque.filter(item => (Number(item.quantidade_total) || 0) === 0).length;
    const totalItensEl = document.getElementById('totalItens');
    const totalCategoriasEl = document.getElementById('totalCategorias');
    const itensCriticosEl = document.getElementById('itensCriticos');
    const ultimaAtualizacaoEl = document.getElementById('ultimaAtualizacao');
    
    if (totalItensEl) totalItensEl.textContent = totalItens.toLocaleString('pt-BR');
    if (totalCategoriasEl) totalCategoriasEl.textContent = totalCategorias;
    if (itensCriticosEl) itensCriticosEl.textContent = itensCriticos;
    if (ultimaAtualizacaoEl) ultimaAtualizacaoEl.textContent = new Date().toLocaleTimeString('pt-BR');
}

function updateChart(estoque) {
    const ctx = document.getElementById('estoqueChart');
    
    if (!ctx) {
        console.error('❌ Elemento estoqueChart não encontrado');
        return;
    }
    
    const ctx2d = ctx.getContext('2d');
    if (estoqueChart) {
        estoqueChart.destroy();
    }
    const labels = estoque.map(item => item.tipo_item);
    const data = estoque.map(item => Number(item.quantidade_total) || 0);
    const backgrounds = estoque.map(item => getChartColor(Number(item.quantidade_total) || 0));
    
    estoqueChart = new Chart(ctx2d, {
        type: 'pie',
        data: {
            labels: labels,
            datasets: [{
                data: data,
                backgroundColor: backgrounds,
                borderColor: 'white',
                borderWidth: 2,
                hoverOffset: 8
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'right',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        pointStyle: 'circle'
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    });
}

function getChartColor(quantidade) {
    if (!quantidade || quantidade === 0) return '#ef4444';
    if (quantidade < 10) return '#f59e0b';
    if (quantidade < 50) return '#10b981';
    return '#3b82f6';
}

function getStatusEstoque(quantidade) {
    if (!quantidade || quantidade === 0) return 'critical';
    if (quantidade < 10) return 'low';
    if (quantidade < 50) return 'good';
    return 'excellent';
}

function getStatusText(status) {
    const statusMap = {
        'excellent': 'Excelente',
        'good': 'Bom',
        'low': 'Baixo',
        'critical': 'Crítico'
    };
    return statusMap[status] || 'Desconhecido';
}

function getIconeItem(tipo) {
    const icones = {
        'Cobertores': 'fa-bed',
        'Alimentos não perecíveis': 'fa-apple-alt',
        'Roupas': 'fa-tshirt',
        'Produtos de higiene': 'fa-pump-soap',
        'Brinquedos': 'fa-puzzle-piece',
        'Calçados': 'fa-shoe-prints',
        'Medicamentos': 'fa-pills',
        'Livros': 'fa-book',
        'Material escolar': 'fa-pencil-alt',
        'Eletrônicos': 'fa-tablet-alt',
        'Móveis': 'fa-couch',
        'Utensílios domésticos': 'fa-utensils'
    };
    
    return icones[tipo] || 'fa-box';
}

function setupEstoqueEvents() {
    const refreshBtn = document.getElementById('refreshEstoque');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', () => {
            loadEstoqueGeral();
            showNotificacao('Estoque atualizado com sucesso!', 'success');
        });
    }
    document.querySelectorAll('.chart-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.chart-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            if (estoqueChart && estoqueData.length > 0) {
                const type = this.dataset.chart;
                estoqueChart.config.type = type;
                estoqueChart.update();
            }
        });
    });
    const exportBtn = document.getElementById('exportEstoque');
    if (exportBtn) {
        exportBtn.addEventListener('click', () => {
            showNotificacao('Funcionalidade de exportação em desenvolvimento', 'info');
        });
    }
    setInterval(() => {
        loadEstoqueGeral();
    }, 30000);
}

function atualizarEstoqueAposDoacao(tipoDoacao, quantidade) {
    loadEstoqueGeral();
    showNotificacao(`Doação registrada: ${quantidade} ${tipoDoacao} adicionado(s) ao estoque`, 'success');
}
function showEditProfileModal() {
    const token = localStorage.getItem('token');
    if (!token) {
        alert('Você precisa estar logado para editar o perfil.');
        return;
    }

    const modalHTML = `
        <div id="editProfileModal" style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        ">
            <div style="
                background: var(--light);
                padding: 30px;
                border-radius: var(--radius);
                width: 90%;
                max-width: 500px;
                max-height: 90vh;
                overflow-y: auto;
            ">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">Editar Foto de Perfil</h3>
                    <button id="closeEditModal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text);">&times;</button>
                </div>
                
                <div id="profilePhotoSection" style="text-align: center; margin-bottom: 30px;">
                    <div style="position: relative; display: inline-block;">
                        <img id="currentProfilePhoto" src="" alt="Foto atual" 
                             style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary);">
                        <div id="photoLoading" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; z-index: 10;">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <label for="photoUpload" class="btn btn-primary" style="cursor: pointer; margin-bottom: 10px; display: inline-block;">
                            <i class="fas fa-camera"></i> Escolher Foto
                        </label>
                        <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                        <br>
                        <button id="removePhotoBtn" class="btn btn-secondary" style="margin-top: 5px;">
                            <i class="fas fa-trash"></i> Remover Foto
                        </button>
                    </div>
                    
                    <div id="photoPreview" style="display: none; margin-top: 15px;">
                        <p style="margin-bottom: 10px; font-weight: 600;">Prévia da nova foto:</p>
                        <img id="previewImage" src="" alt="Preview" 
                             style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 2px solid var(--secondary); margin-bottom: 10px;">
                        <div style="margin-top: 10px;">
                            <button id="confirmPhotoBtn" class="btn btn-success" style="margin-right: 10px;">
                                <i class="fas fa-check"></i> Confirmar
                            </button>
                            <button id="cancelPhotoBtn" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancelar
                            </button>
                        </div>
                    </div>
                </div>
                
                <div style="background: var(--gray-light); padding: 15px; border-radius: var(--radius); margin-bottom: 20px;">
                    <p style="margin: 0; font-size: 0.9rem; color: var(--gray); text-align: left;">
                        <i class="fas fa-info-circle"></i> <strong>Informações:</strong><br>
                        • Formatos suportados: JPG, PNG, GIF<br>
                        • Tamanho máximo: 5MB<br>
                        • A foto será salva no seu perfil
                    </p>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    
                    </button>
                    <button id="closeEditProfile" class="btn btn-primary">
                        <i class="fas fa-times"></i> Fechar
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    loadCurrentProfilePhoto();
    setupEditProfileEvents();
}
async function loadCurrentProfilePhoto() {
    const token = localStorage.getItem('token');
    console.log('🔄 Carregando foto atual do perfil...');
    
    try {
        const response = await fetch('/api/me', {
            headers: { 'Authorization': 'Bearer ' + token }
        });
        
        if (response.ok) {
            const user = await response.json();
            const photoElement = document.getElementById('currentProfilePhoto');
            
            console.log('📸 Dados do usuário:', {
                tem_foto: !!user.foto_perfil,
                tipo: typeof user.foto_perfil,
                usuario: user.email
            });
            
            if (user.foto_perfil && user.foto_perfil.startsWith('data:image/')) {
                photoElement.src = user.foto_perfil;
                console.log('✅ Foto carregada com sucesso');
            } else {
                photoElement.src = 'https://via.placeholder.com/120x120/4a6cf7/ffffff?text=Sem+Foto';
                console.log('ℹ️ Usando placeholder - sem foto');
            }
        } else {
            console.error('❌ Erro na resposta da API:', response.status);
        }
    } catch (error) {
        console.error('❌ Erro ao carregar foto do perfil:', error);
    }
}
function setupEditProfileEvents() {
    const modal = document.getElementById('editProfileModal');
    const closeBtn = document.getElementById('closeEditModal');
    const closeEditBtn = document.getElementById('closeEditProfile');
    const photoUpload = document.getElementById('photoUpload');
    const removePhotoBtn = document.getElementById('removePhotoBtn');
    const confirmPhotoBtn = document.getElementById('confirmPhotoBtn');
    const cancelPhotoBtn = document.getElementById('cancelPhotoBtn');
    
    let selectedFile = null;
    closeBtn.addEventListener('click', () => modal.remove());
    closeEditBtn.addEventListener('click', () => modal.remove());
    modal.addEventListener('click', (e) => {
        if (e.target === modal) modal.remove();
    });
    photoUpload.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        console.log('📁 Arquivo selecionado:', {
            nome: file.name,
            tipo: file.type,
            tamanho: file.size
        });
        if (!file.type.startsWith('image/')) {
            alert('❌ Por favor, selecione apenas arquivos de imagem (JPG, PNG, GIF).');
            return;
        }
        if (file.size > 5 * 1024 * 1024) {
            alert('❌ A imagem deve ter no máximo 5MB.');
            return;
        }
        
        selectedFile = file;
        const reader = new FileReader();
        reader.onload = function(e) {
            console.log('🖼️ Preview gerado, tamanho base64:', e.target.result.length);
            document.getElementById('previewImage').src = e.target.result;
            document.getElementById('photoPreview').style.display = 'block';
        };
        reader.readAsDataURL(file);
    });
    confirmPhotoBtn.addEventListener('click', async () => {
        if (!selectedFile) {
            alert('❌ Nenhuma foto selecionada.');
            return;
        }
        
        const loadingElement = document.getElementById('photoLoading');
        const previewElement = document.getElementById('photoPreview');
        
        loadingElement.style.display = 'flex';
        console.log('🔄 Iniciando upload da foto...');
        
        try {
            const reader = new FileReader();
            reader.onload = async function(e) {
                const base64Image = e.target.result;
                
                console.log('📤 Enviando para API...', {
                    tamanho_base64: base64Image.length,
                    usuario: 'logado'
                });
                
                const token = localStorage.getItem('token');
                const response = await fetch('/api/upload-foto-perfil', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ foto_base64: base64Image })
                });
                
                console.log('📥 Resposta da API:', response.status);
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('✅ Upload bem-sucedido:', result);
                    document.getElementById('currentProfilePhoto').src = base64Image;
                    updateUserPhotoInMenu(base64Image);
                    previewElement.style.display = 'none';
                    photoUpload.value = '';
                    selectedFile = null;
                    
                    showNotificacao('✅ Foto de perfil atualizada com sucesso!', 'success');
                    setTimeout(() => {
                        checkUserLogin();
                    }, 1000);
                    
                } else {
                    const error = await response.json();
                    console.error('❌ Erro na API:', error);
                    showNotificacao('❌ Erro ao atualizar foto: ' + (error.error || 'Erro desconhecido'), 'error');
                }
                
                loadingElement.style.display = 'none';
            };
            
            reader.onerror = function() {
                console.error('❌ Erro ao ler arquivo');
                showNotificacao('❌ Erro ao processar a imagem', 'error');
                loadingElement.style.display = 'none';
            };
            
            reader.readAsDataURL(selectedFile);
            
        } catch (error) {
            console.error('❌ Erro no upload:', error);
            showNotificacao('❌ Erro de conexão: ' + error.message, 'error');
            loadingElement.style.display = 'none';
        }
    });

    cancelPhotoBtn.addEventListener('click', () => {
        document.getElementById('photoPreview').style.display = 'none';
        photoUpload.value = '';
        selectedFile = null;
        console.log('❌ Upload cancelado');
    });
    removePhotoBtn.addEventListener('click', async () => {
        if (!confirm('Tem certeza que deseja remover sua foto de perfil?')) {
            return;
        }
        
        const loadingElement = document.getElementById('photoLoading');
        loadingElement.style.display = 'flex';
        console.log('🗑️ Iniciando remoção da foto...');
        
        try {
            const token = localStorage.getItem('token');
            const response = await fetch('/api/remove-foto-perfil', {
                method: 'DELETE',
                headers: { 'Authorization': 'Bearer ' + token }
            });
            
            console.log('📥 Resposta da remoção:', response.status);
            
            if (response.ok) {
                const result = await response.json();
                console.log('✅ Remoção bem-sucedida:', result);
                document.getElementById('currentProfilePhoto').src = 'https://via.placeholder.com/120x120/4a6cf7/ffffff?text=Sem+Foto';

                updateUserPhotoInMenu(null);
                
                showNotificacao('✅ Foto de perfil removida com sucesso!', 'success');

                setTimeout(() => {
                    checkUserLogin();
                }, 1000);
                
            } else {
                const error = await response.json();
                console.error('❌ Erro na remoção:', error);
                showNotificacao('❌ Erro ao remover foto: ' + (error.error || 'Erro desconhecido'), 'error');
            }
            
            loadingElement.style.display = 'none';
            
        } catch (error) {
            console.error('❌ Erro na remoção:', error);
            showNotificacao('❌ Erro de conexão: ' + error.message, 'error');
            loadingElement.style.display = 'none';
        }
    });

    debugFotoBtn.addEventListener('click', async () => {
        console.log('🐛 Iniciando debug...');
        const token = localStorage.getItem('token');
        
        try {
            const response = await fetch('/api/debug-foto-usuario', {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            
            if (response.ok) {
                const debugInfo = await response.json();
                console.log('🐛 Debug info:', debugInfo);
                alert('Debug completo! Verifique o console do navegador (F12) para ver os detalhes.');
            } else {
                console.error('❌ Erro no debug:', response.status);
            }
        } catch (error) {
            console.error('❌ Erro no debug:', error);
        }
    });
}

function updateUserPhotoInMenu(photoUrl) {
    console.log('🔄 Atualizando foto no menu...', { tem_foto: !!photoUrl });
    
    const userAvatar = document.querySelector('.user-avatar');
    const userAvatarLarge = document.querySelector('.user-avatar-large');
    
    if (userAvatar) {
        userAvatar.src = photoUrl || 'https://via.placeholder.com/32x32/4a6cf7/ffffff?text=U';
        console.log('✅ Avatar pequeno atualizado');
    }
    
    if (userAvatarLarge) {
        userAvatarLarge.src = photoUrl || 'https://via.placeholder.com/50x50/4a6cf7/ffffff?text=U';
        console.log('✅ Avatar grande atualizado');
    }
}

function showNotificacao(message, type = 'info') {
    const existingNotifications = document.querySelectorAll('.notification');
    existingNotifications.forEach(notification => notification.remove());

    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
    `;
    if (!document.querySelector('#notification-styles')) {
        const style = document.createElement('style');
        style.id = 'notification-styles';
        style.textContent = `
            .notification {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 10px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                animation: slideInRight 0.3s ease;
            }
            .notification.success { background: var(--success); }
            .notification.error { background: var(--danger); }
            .notification.info { background: var(--primary); }
            .notification.warning { background: var(--warning); }
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    }
    
    document.body.appendChild(notification);

    setTimeout(() => {
        if (notification.parentNode) {
            notification.style.animation = 'slideOutRight 0.3s ease';
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }
    }, 5000);
}

const themeToggle = document.getElementById('themeToggle');
const body = document.body;

if (themeToggle) {
    if (localStorage.getItem('darkMode') === 'enabled') {
        body.classList.add('dark-mode');
        themeToggle.querySelector('.toggle-handle i').className = 'fas fa-moon';
    }

    themeToggle.addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        
        const icon = themeToggle.querySelector('.toggle-handle i');
        if (body.classList.contains('dark-mode')) {
            icon.className = 'fas fa-moon';
            localStorage.setItem('darkMode', 'enabled');
        } else {
            icon.className = 'fas fa-sun';
            localStorage.setItem('darkMode', 'disabled');
        }
    });
}

const mobileMenuBtn = document.getElementById('mobileMenuBtn');
const navLinks = document.querySelector('.nav-links');

if (mobileMenuBtn && navLinks) {
    mobileMenuBtn.addEventListener('click', () => {
        navLinks.classList.toggle('active');
        mobileMenuBtn.querySelector('i').className = 
            navLinks.classList.contains('active') ? 'fas fa-times' : 'fas fa-bars';
    });
}

window.addEventListener('scroll', () => {
    const header = document.getElementById('header');
    if (header) {
        if (window.scrollY > 100) {
            header.classList.add('header-scrolled');
        } else {
            header.classList.remove('header-scrolled');
        }
    }
});

const tabBtns = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');

tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
        tabBtns.forEach(b => b.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));
        
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
    });
});

const faqItems = document.querySelectorAll('.faq-item');

faqItems.forEach(item => {
    const question = item.querySelector('.faq-question');
    
    question.addEventListener('click', () => {
        faqItems.forEach(i => {
            if (i !== item) {
                i.classList.remove('active');
            }
        });
        
        item.classList.toggle('active');
    });
});

function debugRoute() {
    console.log('🐛 Debug - Estado atual:');
    console.log('- Pontos de coleta:', pontosColeta);
    console.log('- Rota atual:', currentRoute);
    console.log('- Localização usuário:', userLocation);
    console.log('- Mapa inicializado:', !!map);
    const testCoords = [-23.5505, -46.6333];
    calculateRouteToNearestPoint(testCoords);
}

function addDebugButton() {
    const debugBtn = document.createElement('button');
    debugBtn.innerHTML = '🐛 Debug Rota';
    debugBtn.style.position = 'fixed';
    debugBtn.style.bottom = '20px';
    debugBtn.style.right = '20px';
    debugBtn.style.zIndex = '1000';
    debugBtn.style.padding = '10px';
    debugBtn.style.background = '#ffce3e';
    debugBtn.style.color = 'black';
    debugBtn.style.border = 'none';
    debugBtn.style.borderRadius = '5px';
    debugBtn.style.cursor = 'pointer';
    debugBtn.onclick = debugRoute;
    
    document.body.appendChild(debugBtn);
}

function setupAutocompleteItems() {
    const autocompleteItems = document.querySelectorAll('.autocomplete-item');
    const enderecoInput = document.getElementById('enderecoInput');
    
    autocompleteItems.forEach(item => {
        item.addEventListener('click', function() {
            const lat = this.getAttribute('data-lat');
            const lon = this.getAttribute('data-lon');
            const address = this.getAttribute('data-address');
            const search = this.getAttribute('data-search');
            
            if (search) {
            
                window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(search)}`, '_blank');
                return;
            }
            
            if (lat && lon && address) {
                enderecoInput.value = address;
                
                const coords = [parseFloat(lat), parseFloat(lon)];
                map.setView(coords, 15);
                
                if (userMarker) {
                    map.removeLayer(userMarker);
                }
                
                userMarker = L.marker(coords)
                    .addTo(map)
                    .bindPopup(`<strong>📍 Localização selecionada</strong><br>${address}`)
                    .openPopup();
                    
                userLocation = coords;
                
                calculateRouteToNearestPoint(userLocation);
                
                salvarLocalizacaoUsuario(address, coords[0], coords[1]);
            }
            
            document.getElementById('autocompleteResults').classList.remove('active');
        });
        
        item.addEventListener('mouseenter', function() {
            autocompleteItems.forEach(i => i.classList.remove('active'));
            this.classList.add('active');
        });
    });
}

async function loadCurrentProfilePhoto() {
    const token = localStorage.getItem('token');
    
    try {
        const response = await fetch('/api/me', {
            headers: { 'Authorization': 'Bearer ' + token }
        });
        
        if (response.ok) {
            const user = await response.json();
            const photoElement = document.getElementById('currentProfilePhoto');
            
            if (user.foto_perfil && user.foto_perfil.startsWith('data:image/')) {
                photoElement.src = user.foto_perfil;
                console.log('✅ Foto carregada com sucesso');
            } else if (user.foto_perfil && user.foto_perfil.startsWith('http')) {
                photoElement.src = user.foto_perfil;
            } else {
                photoElement.src = 'https://via.placeholder.com/120x120/4a6cf7/ffffff?text=Sem+Foto';
            }
        }
    } catch (error) {
        console.error('❌ Erro ao carregar foto do perfil:', error);
    }
    if (file.size > 2 * 1024 * 1024) {
    alert('❌ A imagem deve ter no máximo 2MB.');
    return;
}
}



</script>
</body>
</html>